VocÇ¦ vai trabalhar de forma autÇïnoma no repositÇürio INOX-VAL, mas com RESTRIÇÎÇES ESTRITAS:

ÐYs® NÇŸO alterar lÇügica de negÇücio
ÐYs® NÇŸO mudar regras do Firestore
ÐYs® NÇŸO mudar estrutura de coleÇõÇæes
ÐYs® NÇŸO criar novas features
ÐYs® NÇŸO refatorar fluxos de ProduÇõÇœo jÇ­ implementados

Seu objetivo Ç¸ ganhar tempo preparando o projeto, melhorando qualidade interna, organizaÇõÇœo e seguranÇõa de cÇüdigo sem alterar comportamento do sistema.

ƒ÷¯

ÐYZî MISSÇŸO: ƒ?oPREPARAÇÎÇŸO SILENCIOSAƒ??

Trabalhe nas Ç­reas abaixo. Todas sÇœo seguras e nÇœo quebram o sistema.

ƒ÷¯

1‹÷?ƒŸœ LIMPEZA DE CÇ"DIGO MORTO (SAFE)
	ƒ?½	Procurar:
	ƒ?½	imports nÇœo usados
	ƒ?½	variÇ­veis nÇœo usadas
	ƒ?½	funÇõÇæes exportadas nunca utilizadas
	ƒ?½	arquivos nÇœo referenciados por ninguÇ¸m
	ƒ?½	Apenas:
	ƒ?½	remover o que for 100% morto
	ƒ?½	se houver dÇ§vida ƒÅ' comentar em vez de apagar

ƒ÷¯

2‹÷?ƒŸœ TIPAGEM E TYPESCRIPT (SEM MUDAR LÇ"GICA)

Melhorar tipagem onde for seguro:
	ƒ?½	Substituir any por tipos existentes do domÇðnio
	ƒ?½	Garantir que:
	ƒ?½	producao.types.ts
	ƒ?½	cliente.types.ts
	ƒ?½	estoque.types.ts
estejam sendo usados corretamente
	ƒ?½	NÇŸO alterar formato de dados ƒ?" sÇü melhorar tipos

ƒ÷¯

3‹÷?ƒŸœ PADRONIZAÇÎÇŸO DE NOMES (APENAS INTERNO)

Padronizar sem mudar comportamento:
	ƒ?½	movId vs movimentoId ƒÅ' usar um padrÇœo interno
	ƒ?½	setorAtual vs setor ƒÅ' padronizar internamente
	ƒ?½	updatedAt vs dataAtualizacao

ƒsÿ‹÷? NÇœo mudar nomes que impactem banco ou API ƒ?" sÇü variÇ­veis internas

ƒ÷¯

4‹÷?ƒŸœ DOCUMENTAÇÎÇŸO AUTOMÇ?TICA DO SISTEMA

Criar arquivos .md dentro de:

/docs

Gerar:
	1.	docs/arquitetura-producao.md
	ƒ?½	Como funciona ProduÇõÇœo hoje
	ƒ?½	Fluxo: item ƒÅ' setor ƒÅ' movimentaÇõÇœo
	2.	docs/fluxo-firestore.md
	ƒ?½	Estrutura:
	ƒ?½	orders_producao/{orderId}
	ƒ?½	orders_producao/{orderId}/items/{itemId}
	ƒ?½	movimentacoes
	3.	docs/hooks-react-query.md
	ƒ?½	Quais hooks existem
	ƒ?½	O que cada um invalida

Somente leitura e documentaÇõÇœo.

ƒ÷¯

5‹÷?ƒŸœ MAPA DE DEPENDÇSNCIAS

Criar:

docs/dependencias-dominios.md

Listar:
	ƒ?½	quais domÇðnios importam outros
	ƒ?½	possÇðveis acoplamentos perigosos
	ƒ?½	onde ProduÇõÇœo depende de:
	ƒ?½	Auth
	ƒ?½	Empresas
	ƒ?½	UsuÇ­rios

ƒ÷¯

6‹÷?ƒŸœ ANÇ?LISE DE PERFORMANCE (SEM ALTERAR CÇ"DIGO)

Criar relatÇürio:

docs/performance-analise.md

Listar:
	ƒ?½	componentes grandes
	ƒ?½	hooks que disparam muitas queries
	ƒ?½	pÇ­ginas com muito re-render
	ƒ?½	possÇðveis pontos de N+1

NÇŸO OTIMIZAR ƒ?" sÇü analisar

ƒ÷¯

7‹÷?ƒŸœ VERIFICAÇÎÇŸO DE SEGURANÇÎA (SÇ" RELATÇ"RIO)

Criar:

docs/firestore-riscos.md

Listar possÇðveis riscos se:
	ƒ?½	empresaId faltar em algum write
	ƒ?½	item for criado sem orderId
	ƒ?½	movimentaÇõÇœo nÇœo validar tenant

ƒsÿ‹÷? NÇœo alterar rules ƒ?" sÇü relatar

ƒ÷¯

8‹÷?ƒŸœ MELHORIAS DE QUALIDADE (SEGURAS)

Pode aplicar:
	ƒ?½	adicionar JSDoc em services
	ƒ?½	adicionar comentÇ­rios em hooks complexos
	ƒ?½	dividir funÇõÇæes grandes em menores (sem mudar lÇügica)
	ƒ?½	remover console.logs esquecidos

ƒ÷¯

9‹÷?ƒŸœ TESTES (SÇ" ESTRUTURA, NÇŸO FUNCIONAIS)

Criar pastas de teste sem implementar testes reais:

src/domains/producao/__tests__
src/domains/clientes/__tests__

Criar arquivos vazios como placeholders:
	ƒ?½	producao.service.test.ts
	ƒ?½	hooks.test.ts

ƒ÷¯

ÐY"Y RELATÇ"RIO FINAL OBRIGATÇ"RIO

Ao final, gerar:

docs/trabalho-noturno-relatorio.md

Com:
	ƒ?½	lista de arquivos alterados
	ƒ?½	lista de arquivos criados
	ƒ?½	o que foi removido
	ƒ?½	o que foi apenas comentado
	ƒ?½	nenhuma mudanÇõa de lÇügica foi feita

ƒ÷¯

ÐY>' PARE IMEDIATAMENTE SE:
	ƒ?½	precisar alterar regra do Firestore
	ƒ?½	precisar mudar estrutura de dados
	ƒ?½	precisar mudar fluxo de ProduÇõÇœo
	ƒ?½	precisar alterar React Query behavior
	ƒ?½	surgir decisÇœo de arquitetura

Nesses casos, apenas escreva no relatÇürio como ƒ?opendÇ¦nciaƒ??.

ƒ÷¯

RESUMO DO QUE VOCÇS PODE FAZER

ƒo. Limpeza
ƒo. Tipagem
ƒo. DocumentaÇõÇœo
ƒo. ComentÇ­rios
ƒo. OrganizaÇõÇœo interna
ƒo. RelatÇürios tÇ¸cnicos

ÐYs® Nada que mude como o sistema funciona

VocÇ¦ estÇ­ no repo INOX-VAL (Vite + React + TS + Firebase/Firestore). Objetivo: acelerar finalizaÇõÇœo com mudanÇõas de baixo risco que nÇœo exigem aprovaÇõÇœo contÇðnua. Trabalhe de forma incremental e segura.

REGRAS (importante)
	ƒ?½	NÇœo alterar regra de negÇücio do mÇüdulo ProduÇõÇœo nem fluxos crÇðticos (Entrada/SaÇðda/Finalizar) sem pedir OK.
	ƒ?½	NÇœo alterar schema de dados existente em produÇõÇœo sem pedir OK.
	ƒ?½	Pode: limpeza, padronizaÇõÇœo, melhoria de build, reduÇõÇœo de warnings, scripts, documentaÇõÇœo, testes automatizÇ­veis, checagens de consistÇ¦ncia, performance nÇœo-funcional, seguranÇõa defensiva (sem mudar comportamento), melhorias de DX.
	ƒ?½	Se encontrar risco real: registrar em ƒ?oRiscos/Notasƒ?? e parar naquele ponto (nÇœo aplicar).

FORMATO DE ENTREGA
	ƒ?½	Abrir/entregar em atÇ¸ 5 PRs (ou commits agrupados) com tÇðtulos:
	1.	build-warnings-and-chunking
	2.	lint-typecheck-ci
	3.	firebase-imports-unification
	4.	docs-and-runbooks
	5.	cleanup-and-consistency
	ƒ?½	Em cada PR: resumo, arquivos tocados, motivo, como validar localmente.

TAREFAS (execute o mÇ­ximo possÇðvel sem precisar de mim)

A) Build / Vite / Chunking (baixo risco)
	1.	Resolver warning: ƒ?ofirebase.ts dinamicamente importado por services/firestore/base.ts mas tambÇ¸m importado estaticamente por vÇ­rias pÇ­ginasƒ??.
	ƒ?½	Escolher UMA estratÇ¸gia e aplicar de forma consistente:
	ƒ?½	EstratÇ¸gia recomendada: tornar src/lib/firebase.ts sempre import estÇ­tico (remover dynamic import no services/firestore/base.ts), ou
	ƒ?½	Padronizar para lazy-load apenas onde fizer sentido (ex.: rotas), sem misturar no mesmo grafo.
	ƒ?½	Garantir que Auth/Login/Signup/ResetPassword continuam funcionando.
	2.	Reduzir chunk gigante:
	ƒ?½	Ajustar build.rollupOptions.output.manualChunks em vite.config.ts separando vendors comuns (react, firebase, charts/html2canvas, editor).
	ƒ?½	NÇœo mexer em runtime behavior, sÇü empacotamento.

B) Qualidade / CI / Scripts (sem mudar app)
3. Adicionar scripts no package.json:
	ƒ?½	ƒ?otypecheckƒ??: ƒ?otsc -p tsconfig.json ƒ?"noEmitƒ??
	ƒ?½	ƒ?olintƒ??: ƒ?oeslint .ƒ??
	ƒ?½	ƒ?oformatƒ??: ƒ?oprettier -w .ƒ??
	ƒ?½	ƒ?ocheckƒ??: rodar lint + typecheck + tests (se existirem)

	4.	Adicionar GitHub Actions simples (ci.yml):
	ƒ?½	install (npm ci)
	ƒ?½	npm run typecheck
	ƒ?½	npm run build
	ƒ?½	(lint se jÇ­ configurado)
	5.	Se ESLint/Prettier nÇœo estiverem padronizados, criar config mÇðnima e nÇœo destrutiva (sem reformatar tudo; apenas preparar).

C) Limpeza de imports e consistÇ¦ncia (baixo risco)
6. Procurar imports ÇürfÇœos/referÇ¦ncias removidas do legado ProduÇõÇœo e corrigir.
	ƒ?½	Search: ƒ?oproducao.service.tsƒ?? removido; garantir que nenhum arquivo fora do domÇðnio importa isso.

	7.	Padronizar aliases/path imports (se tiver @/):
	ƒ?½	Evitar duplicidade de caminhos para o mesmo mÇüdulo.
	8.	Consolidar exports de domÇðnio:
	ƒ?½	src/domains/producao/index.ts exportar apenas o que Ç¸ usado.
	ƒ?½	Evitar re-export confuso.

D) Robustez Firestore (sem mudar regra de negÇücio)
9. Revisar firestore.rules para garantir:
	ƒ?½	Itens/movimentaÇõÇæes exigem tenant do pai (ordem) e bloqueiam cross-tenant.
	ƒ?½	Minimizar permissÇæes; manter consistÇ¦ncia com ƒ?ohasPermission(ƒ?~producaoƒ?T, ƒ?Ý)ƒ??.

	10.	Revisar firestore.indexes.json:

	ƒ?½	Confirmar Çðndices necessÇ­rios para collectionGroup(ƒ?~itemsƒ?T) com os filtros/ordenaÇõÇœo que o app realmente usa.
	ƒ?½	Documentar quais telas usam quais queries.

E) Testes ƒ?orodÇ­veis localmenteƒ?? (nÇœo precisa executar aqui, mas preparar)
11. Criar um arquivo RUNBOOK docs/VALIDACAO-PRODUCAO.md com:
	ƒ?½	PrÇ¸-requisitos (tenant, permissÇæes, dados mÇðnimos)
	ƒ?½	Checklist de smoke test (ControleProduÇõÇœo, ApontamentoOP, DashboardTV)
	ƒ?½	VerificaÇõÇæes no Firestore (campos mÇðnimos, subcoleÇõÇæes)

	12.	Criar script opcional scripts/validate-producao.ps1 (Windows) e/ou .sh:

	ƒ?½	npm ci
	ƒ?½	npm run typecheck
	ƒ?½	npm run build
	ƒ?½	imprimir dicas se falhar
(O script pode existir mesmo que vocÇ¦ nÇœo consiga rodar aqui.)

F) Observabilidade e DX (baixo risco)
13. Garantir logs/auditoria: confirmar que chamadas de escrita passam por writeAuditLog (sem mexer no schema).
14. Padronizar tratamento de erro nos hooks de ProduÇõÇœo:
	ƒ?½	Centralizar mensagens/toast, sem alterar fluxo.

G) DocumentaÇõÇœo do warning de consistÇ¦ncia (sem mexer)
15. Criar docs/ARQUITETURA-PRODUCAO.md explicando:
	ƒ?½	collectionGroup(ƒ?~itemsƒ?T) vs subcoleÇõÇæes por order
	ƒ?½	por que itens carregam campos denormalizados (numeroOrdem, clienteNome etc.)
	ƒ?½	limitaÇõÇæes e prÇüximos passos futuros (sem implementar agora)

SAÇ?DA FINAL
	ƒ?½	Entregar os PRs/commits com as mudanÇõas feitas.
	ƒ?½	Em cada PR: lista de comandos para validar localmente.
	ƒ?½	Se alguma tarefa exigir decisÇœo de produto/regra, registrar em ƒ?oPendÇ¦ncias para aprovaÇõÇœoƒ?? e nÇœo aplicar.

ƒ÷¯

	5.	Sobre ƒ?odeixar ele fazendo algo sem consumir muitoƒ??
O mais eficiente Ç¸: ele preparar PRs de build/CI/docs/limpeza (nÇœo muda comportamento) e vocÇ¦ sÇü revisa amanhÇœ.

VocÇ¦ estÇ­ no repositÇürio INOX-VAL, um ERP para fabricaÇõÇœo de produtos em aÇõo inox.
Existe hoje uma calculadora industrial focada principalmente em bancadas (encosto, centro, lateral, com/sem cuba, prateleira, etc.).

ÐYZî OBJETIVO DESTE ESTUDO

Projetar a evoluÇõÇœo da calculadora para se tornar um sistema genÇ¸rico de produtos parametrizados, capaz de atender:
	ƒ?½	Gabinetes
	ƒ?½	ArmÇ­rios (aÇ¸reos e de chÇœo)
	ƒ?½	Mesas inox
	ƒ?½	Prateleiras
	ƒ?½	Coifas
	ƒ?½	Estruturas especiais

SEM perder:
	ƒ?½	lÇügica determinÇðstica
	ƒ?½	cÇ­lculo real de consumo de chapa
	ƒ?½	geraÇõÇœo automÇ­tica de BOM
	ƒ?½	integraÇõÇœo com orÇõamento, compras e produÇõÇœo

ƒsÿ‹÷? NÇŸO implementar cÇüdigo agora.
ƒsÿ‹÷? NÇŸO modificar arquivos.
ƒsÿ‹÷? Apenas anÇ­lise tÇ¸cnica, modelagem e plano de arquitetura.

ƒ÷¯

ÐY"? PARTE 1 ƒ?" ENTENDER O MODELO ATUAL
	1.	Mapear como a calculadora atual funciona:
	ƒ?½	Onde ficam os modelos de produto (.txt na pasta /model)
	ƒ?½	Como os parÇ½metros viram dimensÇæes, blanks e BOM
	ƒ?½	Como calcula consumo de chapa e peso
	ƒ?½	Como integra com orÇõamento
	2.	Resumir o padrÇœo estrutural atual:
	ƒ?½	Inputs tÇðpicos (L, P, A, espessura, cuba, reforÇõo etc.)
	ƒ?½	SaÇðdas geradas (peÇõas, cortes, custos)
	ƒ?½	LimitaÇõÇæes atuais (sÇü funciona bem para bancadas)

ƒ÷¯

ÐYõ¸ PARTE 2 ƒ?" PROBLEMA DE ESCALABILIDADE

Explicar tecnicamente:
	ƒ?½	Por que o modelo atual nÇœo escala bem para gabinetes/armÇ­rios
	ƒ?½	DiferenÇõa estrutural entre:
	ƒ?½	Produto ƒ?oplano dominanteƒ?? (bancada)
	ƒ?½	Produto ƒ?ocaixa estruturalƒ?? (gabinete/armÇ­rio)
	ƒ?½	Desafios novos:
	ƒ?½	portas
	ƒ?½	prateleiras internas
	ƒ?½	reforÇõos verticais
	ƒ?½	fundo, laterais, teto/base
	ƒ?½	ferragens

ƒ÷¯

ÐY?- PARTE 3 ƒ?" ARQUITETURA DO NOVO SISTEMA

Projetar um Sistema de Templates de Produto Parametrizado

1‹÷?ƒŸœ Conceito

Cada produto passa a ser definido por um Template Parametrizado, contendo:
	ƒ?½	VariÇ­veis de entrada
	ƒ?½	Regras geomÇ¸tricas
	ƒ?½	FÇürmulas determinÇðsticas
	ƒ?½	GeraÇõÇœo de peÇõas (BOM)

2‹÷?ƒŸœ Modelo de dados sugerido (Firestore)

Desenhar estrutura de collections:

produtos_templates
produtos_templates/{id}/versoes/{v}
produtos_templates/{id}/versoes/{v}/variaveis
produtos_templates/{id}/versoes/{v}/regras
produtos_templates/{id}/versoes/{v}/formulas

Explicar:
	ƒ?½	versionamento
	ƒ?½	snapshot em orÇõamento
	ƒ?½	auditoria
	ƒ?½	multi-tenant

ƒ÷¯

ƒsT‹÷? PARTE 4 ƒ?" MOTOR DE CÇ?LCULO GENÇ%RICO

Descrever como o motor deve funcionar:
	ƒ?½	Interpretar variÇ­veis definidas pelo template
	ƒ?½	Resolver fÇürmulas sem usar eval (usar parser seguro)
	ƒ?½	Gerar lista de peÇõas padronizada
	ƒ?½	Classificar peÇõas por categoria (corpo, porta, prateleira, reforÇõo)
	ƒ?½	Enviar peÇõas para o mÇüdulo de nesting existente
	ƒ?½	Calcular custo, peso e consumo de chapa

ƒ÷¯

ÐYõ© PARTE 5 ƒ?" CASO DE ESTUDO: GABINETE SIMPLES

Criar um exemplo tÇ¸cnico de template:

Produto: Gabinete inox simples

Entradas:
	ƒ?½	L (largura)
	ƒ?½	P (profundidade)
	ƒ?½	A (altura)
	ƒ?½	n¶§ portas (1 ou 2)
	ƒ?½	n¶§ prateleiras internas
	ƒ?½	espessura corpo
	ƒ?½	espessura portas

Regras:
	ƒ?½	L mÇðnima para 2 portas
	ƒ?½	folgas de dobra
	ƒ?½	travessa traseira
	ƒ?½	reforÇõo frontal

SaÇðdas:
	ƒ?½	laterais (2)
	ƒ?½	topo
	ƒ?½	base
	ƒ?½	fundo
	ƒ?½	portas
	ƒ?½	prateleiras
	ƒ?½	reforÇõos

ƒ÷¯

ÐYõð PARTE 6 ƒ?" PLANO DE TRANSIÇÎÇŸO

Criar plano em fases:

Fase 1 ƒ?" Adaptar calculadora atual para produzir saÇðda padronizada
Fase 2 ƒ?" Criar motor de templates
Fase 3 ƒ?" Migrar bancadas para template
Fase 4 ƒ?" Implementar primeiro template novo (Gabinete)
Fase 5 ƒ?" Conectar com orÇõamento
Fase 6 ƒ?" Conectar com produÇõÇœo e compras

Cada fase com:
	ƒ?½	objetivo
	ƒ?½	impacto no sistema
	ƒ?½	risco
	ƒ?½	critÇ¸rio de aceite

ƒ÷¯

ÐY"O FORMATO DA RESPOSTA

Usar seÇõÇæes claras
Bullets tÇ¸cnicos
Sem textos longos
Sempre linguagem prÇ­tica de engenharia
